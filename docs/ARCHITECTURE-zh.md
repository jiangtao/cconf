# 架构设计

## 概述

ccconfig 使用简单的三层架构：

1. **CLI 层** (`cmd/`) - 命令行界面
2. **业务层** (`pkg/backup/`, `pkg/restore/`) - 核心逻辑
3. **支持层** (`pkg/config`, `pkg/git`, `pkg/i18n`, `pkg/ui`) - 工具函数

```
┌─────────────────────────────────────────────────────────┐
│                         CLI 层                           │
│  用户命令：backup, restore, cache, init                    │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│                         业务层                           │
│  设置、命令等备份和恢复逻辑                                 │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│                         支持层                           │
│  配置、Git、国际化、界面辅助                                 │
└─────────────────────────────────────────────────────────┘
```

## 核心包

| 包 | 用途 |
|------|------|
| `pkg/backup/` | 备份设置、命令、技能、项目 |
| `pkg/restore/` | 从备份恢复 |
| `pkg/config/` | 从标志和文件加载配置 |
| `pkg/git/` | Git 操作（初始化、添加、提交、推送） |
| `pkg/i18n/` | 多语言支持（英文/中文） |

## 工作原理

### 备份流程

```
用户运行：ccconfig backup
    │
    ▼
加载配置（标志 + ~/.ccconfig.yaml）
    │
    ▼
备份设置 → 命令 → 技能 → 项目
    │
    ▼
Git add + commit（可选：push）
    │
    ▼
完成！✅
```

### 恢复流程

```
用户运行：ccconfig restore
    │
    ▼
Git pull（获取最新配置）
    │
    ▼
恢复设置 → 命令 → 技能 → 项目
    │
    ▼
提示输入 API 令牌（如需要）
    │
    ▼
完成！✅
```

## 开发者指南

### 添加新命令

1. 在 `cmd/` 中创建文件
2. 使用 Cobra 库
3. 在 `init()` 中注册

### 添加新语言

1. 创建 `pkg/i18n/{lang}.yaml`
2. 添加翻译

更多详情请参阅 [DEVELOPMENT-zh.md](DEVELOPMENT-zh.md)。

---

## 其他语言

- **English:** [ARCHITECTURE.md](ARCHITECTURE.md)
